<body>
  <div>
    <div *ngIf="dataLoaded">
      <table class="table2">
        <thead>

          <th class="corlinha">
            ECOS Follow-up
          </th>
        </thead>
      </table>

      <div>
        <form>
          <button (click)="filtrarItensAll()">All Itens</button>
          <button (click)="filtrarItens()">Over Stock</button>
          <!-- Adicione botões para outros status, se necessário -->

          <label>Qty itens: {{ itensFiltrados.length }}</label>
          <ng-container *ngFor="let status of ['Accepted', 'Denied', 'Analyzing']">
            <label>{{ status }}: {{ getStatusCount(status) }}</label>
          </ng-container>

          <label>Without Analysis: {{ getOtherStatusCount() }}</label>
        </form>
      </div>
      <div>
        <table>
          <tr>
            <td>
              OverStock Cost: {{ calculateTotalCost() | currency: 'BRL' }}
            </td>
            <td>
              Possible Saving: {{ calculateTotalCostAvoid() | currency: 'BRL' }}
            </td>
          </tr>
        </table>
      </div>



      <div class="table2">
        <table>
          <thead>
            <tr>
              <th class="auto-width">
                Last Update
              </th>
              <th class="auto-width">
                ECO Number
              </th>
              <th class="auto-width">
                Disc Part Number
              </th>
              <th class="auto-width">
                <button (click)="sortBy2('SOP')">SOP</button>
              </th>
              <th class="auto-width">
                <button (click)="sortBy2('SOCOP')">SOCOP</button>
              </th>
              <th class="auto-width">
                <button (click)="sortBy2('SOPDev')">SOP Dev</button>
              </th>

              <th class="auto-width">
                <button (click)="sortBy2('SOCOPDev')">SOCOP Dev</button>
              </th>

              <th class="auto-width">
                Stock
              </th>
              <th class="auto-width">
                Calloff + Pipeline
              </th>
              <th class="auto-width">
                Consumption
              </th>
              <th class="auto-width">
                Line
              </th>
              <th class="auto-width">
                Total Qty
              </th>
              <th class="auto-width">
                Item Cost
              </th>
              <th>
                <button (click)="sortBy2('TotalCost')">Total Cost</button>
              </th>
              <th class="auto-width">
                Comment
              </th>
              <th>
                <button (click)="sortBy2('StatusWork')">Status</button>
              </th>
            </tr>
          </thead>
          <tbody>
            <ng-container *ngFor="let item of itensFiltrados; let i = index">
              <tr [ngClass]="{
                'red-border': item.StatusWork === 'Denied'
            }">
                <td>{{ item.UpdateDate | date:'dd/MM/yyyy' }}</td>
                <td>{{ item.EcoN }}</td>
                <td>{{item.Peca}}</td>
                <td [ngClass]="{ 'red-bg': isDateBeforeToday(item.convertedDateSOP) }">
                  {{ item.convertedDateSOP | date: 'dd/MM/yyyy' }}
                </td>
                <td [ngClass]="{ 'red-bg': isDateBeforeToday(item.convertedDateSOCOP) }">
                  {{ item.convertedDateSOCOP | date: 'dd/MM/yyyy' }}
                </td>
                <td [ngClass]="{ 'red-bg': isDateBeforeToday(item.convertedDateSOPDev) }">
                  {{ item.convertedDateSOPDev | date: 'dd/MM/yyyy' }}
                </td>
                <td [ngClass]="{ 'red-bg': isDateBeforeToday(item.convertedDateSOCOPDev) }">
                  {{ item.convertedDateSOCOPDev | date: 'dd/MM/yyyy' }}
                </td>

                <td>{{item.Stock}}</td>
                <td>{{item.Call}}</td>
                <td>{{item.DB12}}</td>
                <td>{{item.Line}}</td>
                <td>
                  {{
                  (+item.Stock || 0) +
                  (+item.Line || 0) +
                  (+item.Call || 0) -
                  (+item.DB12 || 0)
                  }}
                </td>
                <td>R$ {{item.Custo}}</td>
                <td>
                  {{
                  calculateTotal(item).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })
                  }}
                </td>

                <td (click)="InsereComent(item, 'Coment')" style="max-width: 200px; overflow: hidden;">
                  <ng-container *ngIf="item.Coment !== '' && item.Coment !== undefined; else icon">
                    {{ item.Coment }}
                  </ng-container>
                  <ng-template #icon>
                    <i-feather name="message-circle"></i-feather>
                  </ng-template>
                </td>




                <td (click)="InsereStatus(item, 'StatusWork')" [ngStyle]="{
    'max-width': '200px',
    'overflow': 'hidden',
    'border': (item.StatusWork === 'Accepted') ? '2px solid green' :
              (item.StatusWork === 'Denied') ? '2px solid red' :
              (item.StatusWork === 'Analyzing') ? '2px solid yellow' : 'none'
  }">
                  <ng-container *ngIf="item.StatusWork !== '' && item.StatusWork !== undefined; else icon2">
                    {{ item.StatusWork }}
                  </ng-container>
                  <ng-template #icon2>
                    <i-feather name="meh"></i-feather>
                  </ng-template>
                </td>





              </tr>
            </ng-container>
          </tbody>
        </table>
      </div>

    </div>
  </div>
</body>
